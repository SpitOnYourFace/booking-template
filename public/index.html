<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forever Young ‚Äî –°–∞–ª–æ–Ω –∑–∞ –∫—Ä–∞—Å–æ—Ç–∞ –ë–∞–Ω—Å–∫–æ</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíÖ</text></svg>">
    <meta name="description" content="–§—Ä–∏–∑—å–æ—Ä—Å–∫–∏ —É—Å–ª—É–≥–∏, –∫–æ–∑–º–µ—Ç–∏–∫–∞, –º–∞—Å–∞–∂–∏, –º–∞–Ω–∏–∫—é—Ä –∏ –ø–µ–¥–∏–∫—é—Ä –≤ –ë–∞–Ω—Å–∫–æ. Forever Young ‚Äî –∑–∞–ø–∞–∑–µ—Ç–µ —á–∞—Å –æ–Ω–ª–∞–π–Ω!">
    <meta name="theme-color" content="#E8A0BF">
    <link rel="stylesheet" href="style.css">
    <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" as="style" href="https://unpkg.com/aos@2.3.1/dist/aos.css" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
    </noscript>
</head>
<body>

    <header data-aos="fade-down">
        <div class="logo">FOREVER YOUNG</div>
        <div class="mobile-menu-btn" onclick="toggleMobileMenu()"><i class="fas fa-bars"></i></div>
        <nav><ul id="navLinks">
            <li><a href="#home" onclick="closeMobileMenu()">–ù–∞—á–∞–ª–æ</a></li>
            <li><a href="#team" onclick="closeMobileMenu()">–ï–∫–∏–ø</a></li>
            <li><a href="#services" onclick="closeMobileMenu()">–£—Å–ª—É–≥–∏</a></li>
            <li><a href="#info" onclick="closeMobileMenu()">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
        </ul></nav>
    </header>

    <!-- Hero -->
    <section id="home" class="hero" style="background: linear-gradient(rgba(26,18,24,0.65), rgba(26,18,24,0.85)), url('https://images.unsplash.com/photo-1560066984-138dadb4c035?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80') center/cover no-repeat;">
        <h1 data-aos="zoom-in">–ö—Ä–∞—Å–æ—Ç–∞—Ç–∞ –µ <span>–≤–µ—á–Ω–∞</span></h1>
        <p data-aos="fade-up" data-aos-delay="200">–§—Ä–∏–∑—å–æ—Ä—Å–∫–∏ —É—Å–ª—É–≥–∏ ¬∑ –ö–æ–∑–º–µ—Ç–∏–∫–∞ ¬∑ –ú–∞—Å–∞–∂–∏ ¬∑ –ú–∞–Ω–∏–∫—é—Ä & –ü–µ–¥–∏–∫—é—Ä<br>5 –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–∏—Å—Ç–∏, –µ–¥–Ω–æ –º—è—Å—Ç–æ –∑–∞ –∫—Ä–∞—Å–æ—Ç–∞ –≤ –ë–∞–Ω—Å–∫–æ</p>
        <a href="#services" class="btn" data-aos="fade-up" data-aos-delay="400">–ó–∞–ø–∞–∑–∏ –ß–∞—Å</a>
    </section>

    <!-- Team -->
    <section id="team" class="team-section">
        <div class="services-header" data-aos="fade-up">
            <span class="section-label"><i class="fas fa-heart"></i> –ù–∞—à–∏—è—Ç –µ–∫–∏–ø</span>
            <h2 class="section-title">5 –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–∏—Å—Ç–∏, –µ–¥–Ω–∞ –º–∏—Å–∏—è</h2>
            <div class="title-decoration"><span class="line"></span><span class="scissors">‚úø</span><span class="line"></span></div>
        </div>
        <div class="team-grid" id="teamGrid"></div>
    </section>

    <!-- Services -->
    <section id="services" class="services">
        <div class="services-header" data-aos="fade-up">
            <span class="section-label"><i class="fas fa-spa"></i> –ö–∞–∫–≤–æ –ø—Ä–µ–¥–ª–∞–≥–∞–º–µ</span>
            <h2 class="section-title">–ù–∞—à–∏—Ç–µ –£—Å–ª—É–≥–∏</h2>
            <div class="title-decoration"><span class="line"></span><span class="scissors">‚úø</span><span class="line"></span></div>
        </div>
        <div class="service-grid" id="serviceGrid"></div>
    </section>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>–ó–∞–ø–∞–∑–∏ —á–∞—Å</h2>
            <p id="serviceTitle">–ò–∑–±—Ä–∞–Ω–∞ —É—Å–ª—É–≥–∞: <span id="selectedService"></span></p>

            <!-- Step 1: Stylist Selection -->
            <div id="stylistStep">
                <label style="font-size:14px;font-weight:500;display:block;margin-bottom:10px;">–ò–∑–±–µ—Ä–µ—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç:</label>
                <div id="stylistGrid" class="stylist-grid"></div>
            </div>

            <!-- Step 2: Date & Time -->
            <div id="dateTimeStep" style="display:none;">
                <div class="step-back" onclick="backToStylist()"><i class="fas fa-arrow-left"></i> <span id="selectedStylistName">–ù–∞–∑–∞–¥</span></div>
                <div class="form-group">
                    <label>–ò–∑–±–µ—Ä–∏ –î–∞—Ç–∞:</label>
                    <div id="dateScroller" class="date-scroller"></div>
                    <input type="hidden" id="datePicker">
                </div>
                <div id="slotsGrid" class="slots-grid"><p class="placeholder-text">–ò–∑–±–µ—Ä–∏ –¥–∞—Ç–∞ –æ—Ç–≥–æ—Ä–µ.</p></div>
                <div id="clientDetails" style="display:none;">
                    <input type="text" id="clientName" placeholder="–í–∞—à–µ—Ç–æ –ò–º–µ" required>
                    <input type="tel" id="clientPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (0888123456)" required>
                    <small id="phoneError" style="color:#e87777;display:none;margin-bottom:10px;">–ù–µ–≤–∞–ª–∏–¥–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω</small>
                    <div id="blockedMessage" style="display:none;background:rgba(232,119,119,0.1);border:1px solid rgba(232,119,119,0.3);border-radius:12px;padding:15px;margin-bottom:15px;text-align:center;">
                        <div style="font-size:28px;margin-bottom:8px;">üö´</div>
                        <p style="color:#e87777;font-weight:600;margin:0;">–ù–µ –º–æ–∂–µ—Ç–µ –¥–∞ –∑–∞–ø–∞–∑–∏—Ç–µ —á–∞—Å</p>
                    </div>
                    <input type="email" id="clientEmail" placeholder="Email (–Ω–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ)">
                    <small style="color:var(--text-muted);display:block;margin-bottom:15px;font-size:12px;">–ó–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ –∏ –Ω–∞–ø–æ–º–Ω—è–Ω–µ</small>
                    <button class="btn" id="submitBtn" onclick="submitBooking()" style="width:100%;">
                        <span class="btn-text">–ò–∑–ø—Ä–∞—Ç–∏ –∑–∞—è–≤–∫–∞</span>
                        <span class="btn-loading" style="display:none;"><i class="fas fa-spinner fa-spin"></i> –ò–∑–ø—Ä–∞—â–∞–Ω–µ...</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content success-content">
            <div id="statusPending">
                <div class="status-icon pending-pulse">‚è≥</div>
                <h2>–ó–∞—è–≤–∫–∞—Ç–∞ –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∞!</h2>
                <p>–û—á–∞–∫–≤–∞–º–µ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ...</p>
                <div class="confirmation-box"><p>–í–∞—à–∏—è—Ç –∫–æ–¥:</p><div class="confirmation-code" id="confirmationCode">-</div></div>
                <div class="auto-refresh-note"><div class="spinner"></div><span>–ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ —Å—Ç–∞—Ç—É—Å–∞...</span></div>
                <button class="btn btn-secondary" onclick="closeSuccess()">–ó–∞—Ç–≤–æ—Ä–∏</button>
            </div>
            <div id="statusConfirmed" style="display:none;">
                <div class="status-icon confirmed-bounce">‚úÖ</div>
                <h2>–ß–∞—Å—ä—Ç –µ –ü–û–¢–í–™–†–î–ï–ù!</h2>
                <div class="booking-details" id="bookingDetails"></div>
                <div class="confirmation-box success-box"><p>–ö–æ–¥:</p><div class="confirmation-code" id="confirmationCodeConfirmed">-</div></div>
                <p class="success-note">–û—á–∞–∫–≤–∞–º–µ –≤–∏! üíï</p>
                <button class="btn" onclick="closeSuccess()">–°—Ç—Ä–∞—Ö–æ—Ç–Ω–æ!</button>
            </div>
            <div id="statusRejected" style="display:none;">
                <div class="status-icon">‚ùå</div>
                <h2>–ß–∞—Å—ä—Ç –µ –æ—Ç–∫–∞–∑–∞–Ω</h2>
                <p>–ú–æ–ª—è, –∏–∑–±–µ—Ä–µ—Ç–µ –¥—Ä—É–≥ —á–∞—Å –∏–ª–∏ —Å–µ —Å–≤—ä—Ä–∂–µ—Ç–µ —Å –Ω–∞—Å.</p>
                <a href="tel:+359898779073" class="btn">üìû –û–±–∞–¥–∏ —Å–µ</a>
                <button class="btn btn-secondary" onclick="closeSuccess()">–ó–∞—Ç–≤–æ—Ä–∏</button>
            </div>
        </div>
    </div>

    <!-- Gallery -->
    <div class="gallery-strip" data-aos="fade-up">
        <img class="gallery-img" src="https://images.unsplash.com/photo-1522337360788-8b13dee7a37e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=75" alt="–ú–∞–Ω–∏–∫—é—Ä" loading="lazy">
        <img class="gallery-img" src="https://images.unsplash.com/photo-1519824145371-296894a0daa9?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=75" alt="–§—Ä–∏–∑—å–æ—Ä—Å–∫–∏ —É—Å–ª—É–≥–∏" loading="lazy">
        <img class="gallery-img" src="https://images.unsplash.com/photo-1570172619644-dfd03ed5d881?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=75" alt="–¢–µ—Ä–∞–ø–∏—è –∑–∞ –ª–∏—Ü–µ" loading="lazy">
        <img class="gallery-img" src="https://images.unsplash.com/photo-1600948836101-f9ffda59d250?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=75" alt="–°–∞–ª–æ–Ω" loading="lazy">
    </div>

    <!-- Info Section -->
    <section id="info" class="info-section">
        <div class="info-container">
            <div class="info-main" data-aos="fade-right">
                <h2>–ù–∞–º–µ—Ä–µ—Ç–µ –Ω–∏</h2>
                <div class="location-display"><i class="fas fa-map-marker-alt"></i><div><span class="district-name">–ë–∞–Ω—Å–∫–æ</span><span class="street-name">—É–ª. ‚Äû–¶–∞—Ä –°–∏–º–µ–æ–Ω" 21</span></div></div>
                <div class="rating-display"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><span>5.0 –æ—Ç 6 –æ—Ç–∑–∏–≤–∞</span></div>
                <a href="https://www.google.com/maps/search/?api=1&query=Forever+Young+—Å–∞–ª–æ–Ω+–∫—Ä–∞—Å–æ—Ç–∞+–ë–∞–Ω—Å–∫–æ" target="_blank" class="directions-btn"><i class="fas fa-directions"></i> –£–ø—ä—Ç–≤–∞–Ω–µ</a>
            </div>
            <div class="info-cards" data-aos="fade-left">
                <div class="info-card">
                    <div class="info-card-icon"><i class="fas fa-clock"></i></div>
                    <div class="info-card-content"><h4>–†–∞–±–æ—Ç–Ω–æ –≤—Ä–µ–º–µ</h4>
                        <div class="hours-list">
                            <div class="hour-row"><span>–ü–æ–Ω - –ü–µ—Ç</span><span class="hour-time">09:00 - 18:30</span></div>
                            <div class="hour-row"><span>–°—ä–±–æ—Ç–∞</span><span class="hour-time">09:00 - 15:00</span></div>
                            <div class="hour-row closed"><span>–ù–µ–¥–µ–ª—è</span><span class="hour-time">–ó–∞—Ç–≤–æ—Ä–µ–Ω–æ</span></div>
                        </div>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-card-icon"><i class="fas fa-phone-alt"></i></div>
                    <div class="info-card-content"><h4>–ö–æ–Ω—Ç–∞–∫—Ç–∏</h4>
                        <a href="tel:+359898779073" class="contact-link"><i class="fas fa-phone"></i> 089 877 9073</a>
                        <a href="tel:+359895600582" class="contact-link" style="margin-top:8px"><i class="fas fa-phone"></i> 089 560 0582</a>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-card-icon"><i class="fas fa-share-alt"></i></div>
                    <div class="info-card-content"><h4>–°–æ—Ü–∏–∞–ª–Ω–∏ –º—Ä–µ–∂–∏</h4>
                        <div class="social-links">
                            <a href="https://www.facebook.com/people/Forever-young-%D1%81%D0%B0%D0%BB%D0%BE%D0%BD-%D0%B7%D0%B0-%D0%BA%D1%80%D0%B0%D1%81%D0%BE%D1%82%D0%B0/100064066777990/" target="_blank" class="social-btn facebook"><i class="fab fa-facebook-f"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="contact" class="contact">
        <h2 class="section-title">–ì–æ—Ç–æ–≤–∏ –∑–∞ –ø—Ä–æ–º—è–Ω–∞?</h2>
        <p>–ó–∞–ø–∞–∑–µ—Ç–µ —á–∞—Å –∏ —Å–µ –¥–æ–≤–µ—Ä–µ—Ç–µ –Ω–∞ –Ω–∞—à–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–∏—Å—Ç–∏.</p>
        <a href="tel:+359898779073" class="btn"><i class="fas fa-phone"></i> 089 877 9073</a>
    </section>

    <footer><p>&copy; 2026 Forever Young ‚Äî –°–∞–ª–æ–Ω –∑–∞ –∫—Ä–∞—Å–æ—Ç–∞, –ë–∞–Ω—Å–∫–æ</p></footer>

    <!-- Floating Book Button -->
    <a href="#services" class="floating-book-btn" id="floatingBtn"><i class="fas fa-calendar-plus"></i></a>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js" defer></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        if(typeof AOS!=='undefined') AOS.init({duration:800,once:true});
        else{const w=setInterval(()=>{if(typeof AOS!=='undefined'){clearInterval(w);AOS.init({duration:800,once:true});}},50);setTimeout(()=>clearInterval(w),5000);}
        loadConfig();
    });

    let CONFIG = null, STYLISTS_DATA = [];
    let currentService='', currentPrice=0, selectedTime=null, selectedStylist=null;

    async function loadConfig() {
        try {
            const res = await fetch('/api/config');
            CONFIG = await res.json();
            STYLISTS_DATA = CONFIG.stylists || [];
            renderTeam();
            renderServices();
        } catch(e) { console.error('Config load failed'); }
    }

    function renderTeam() {
        const grid = document.getElementById('teamGrid');
        grid.innerHTML = STYLISTS_DATA.map((s, i) => `
            <div class="team-card" data-aos="fade-up" data-aos-delay="${i*100}">
                <div class="team-avatar">${s.emoji}</div>
                <h4>${s.name}</h4>
                <p>${s.role}</p>
            </div>
        `).join('');
    }

    function renderServices() {
        if (!CONFIG) return;
        const grid = document.getElementById('serviceGrid');
        grid.innerHTML = CONFIG.services.map((s, i) => `
            <div class="service-card ${s.featured?'featured':''}" data-aos="fade-up" data-aos-delay="${i*100}" onclick="selectService('${s.name}', ${s.price})">
                ${s.featured ? '<div class="featured-badge"><i class="fas fa-star"></i> –•–∏—Ç</div>' : ''}
                <div class="service-icon"><i class="${s.icon}"></i></div>
                <h3>${s.name}</h3>
                <p>${s.description}</p>
                <div class="service-footer">
                    <span class="price">${s.price} –ª–≤.</span>
                    <button class="book-btn">–ó–∞–ø–∞–∑–∏</button>
                </div>
            </div>
        `).join('');
    }

    function showToast(msg,type='success'){const t=document.createElement('div');t.className=`toast toast-${type}`;t.innerText=msg;document.body.appendChild(t);setTimeout(()=>t.classList.add('show'),100);setTimeout(()=>{t.classList.remove('show');setTimeout(()=>document.body.removeChild(t),300);},3000);}
    function toggleMobileMenu(){document.getElementById('navLinks').classList.toggle('active');}
    function closeMobileMenu(){document.getElementById('navLinks').classList.remove('active');}

    const modal = document.getElementById("bookingModal");

    function selectService(name, price) {
        currentService = name; currentPrice = price; selectedStylist = null; selectedTime = null;
        document.getElementById("selectedService").innerText = name + " (" + price + " –ª–≤.)";

        // Show stylist selection
        const grid = document.getElementById("stylistGrid");
        const relevantStylists = STYLISTS_DATA.filter(s => s.services.includes(name));

        if (relevantStylists.length === 0) {
            // No stylists configured ‚Äî skip step
            selectedStylist = null;
            document.getElementById("stylistStep").style.display = "none";
            document.getElementById("dateTimeStep").style.display = "block";
            modal.style.display = "block";
            generateDates();
            return;
        }

        grid.innerHTML = relevantStylists.map(s => `
            <div class="stylist-option" onclick="chooseStylist('${s.name}', '${s.emoji}')">
                <div class="stylist-emoji">${s.emoji}</div>
                <div class="stylist-name">${s.name}</div>
                <div class="stylist-role">${s.role}</div>
            </div>
        `).join('') + `
            <div class="stylist-option any-stylist" onclick="chooseStylist(null, 'üé≤')">
                <div class="stylist-emoji">üé≤</div>
                <div class="stylist-name">–ë–µ–∑ –∑–Ω–∞—á–µ–Ω–∏–µ</div>
                <div class="stylist-role">–ü—ä—Ä–≤–∏ —Å–≤–æ–±–æ–¥–µ–Ω</div>
            </div>
        `;

        document.getElementById("stylistStep").style.display = "block";
        document.getElementById("dateTimeStep").style.display = "none";
        modal.style.display = "block";
    }

    function chooseStylist(name, emoji) {
        selectedStylist = name;
        document.getElementById("selectedStylistName").textContent = name ? (emoji + ' ' + name) : 'üé≤ –ë–µ–∑ –∑–Ω–∞—á–µ–Ω–∏–µ';
        document.getElementById("stylistStep").style.display = "none";
        document.getElementById("dateTimeStep").style.display = "block";
        generateDates();
    }

    function backToStylist() {
        document.getElementById("dateTimeStep").style.display = "none";
        document.getElementById("stylistStep").style.display = "block";
        document.getElementById("clientDetails").style.display = "none";
        selectedTime = null;
    }

    function generateDates() {
        const s=document.getElementById("dateScroller"); s.innerHTML="";
        const days=['–ù–µ–¥','–ü–æ–Ω','–í—Ç–æ','–°—Ä—è','–ß–µ—Ç','–ü–µ—Ç','–°—ä–±'], months=['–Ø–Ω—É','–§–µ–≤','–ú–∞—Ä','–ê–ø—Ä','–ú–∞–π','–Æ–Ω–∏','–Æ–ª–∏','–ê–≤–≥','–°–µ–ø','–û–∫—Ç','–ù–æ–µ','–î–µ–∫'];
        for(let i=0;i<14;i++){const d=new Date();d.setDate(d.getDate()+i);const iso=d.toISOString().split('T')[0];const dn=i===0?"–î–Ω–µ—Å":i===1?"–£—Ç—Ä–µ":days[d.getDay()];
            // Skip Sunday
            if(d.getDay()===0) continue;
            const c=document.createElement("div");c.className="date-card";
            if(document.getElementById("datePicker").value==='' && i===0) { c.classList.add("active"); document.getElementById("datePicker").value=iso; loadSlots(); }
            c.onclick=()=>selectDate(c,iso);c.innerHTML=`<span class="day-name">${dn}</span><span class="day-number">${d.getDate()}</span><span class="month-name">${months[d.getMonth()]}</span>`;s.appendChild(c);
        }
        if (!document.getElementById("datePicker").value) {
            // If today is Sunday, pick first available
            const first = s.querySelector('.date-card');
            if (first) first.click();
        }
    }

    function selectDate(el,date){document.querySelectorAll(".date-card").forEach(c=>c.classList.remove("active"));el.classList.add("active");document.getElementById("datePicker").value=date;loadSlots();}

    function closeModal(){modal.style.display="none";document.getElementById("clientDetails").style.display="none";document.getElementById("clientName").value="";document.getElementById("clientPhone").value="";document.getElementById("clientEmail").value="";document.getElementById("blockedMessage").style.display="none";document.getElementById("submitBtn").style.display="";document.getElementById("stylistStep").style.display="block";document.getElementById("dateTimeStep").style.display="none";document.getElementById("datePicker").value="";selectedTime=null;selectedStylist=null;}

    let statusCheckTimeout=null,currentBookingCode=null,pollCount=0;
    const POLL_INTERVALS=[3,5,5,10,10,15,15,30];

    function closeSuccess(){document.getElementById("successModal").style.display="none";if(statusCheckTimeout)clearTimeout(statusCheckTimeout);pollCount=0;document.getElementById("statusPending").style.display="block";document.getElementById("statusConfirmed").style.display="none";document.getElementById("statusRejected").style.display="none";}
    function showBookingStatus(code){currentBookingCode=code;document.getElementById("confirmationCode").innerText=code;document.getElementById("successModal").style.display="block";pollCount=0;checkStatus(code);}
    function scheduleNextPoll(code){const interval=POLL_INTERVALS[Math.min(pollCount,POLL_INTERVALS.length-1)]*1000;pollCount++;statusCheckTimeout=setTimeout(()=>checkStatus(code),interval);}

    async function checkStatus(code){
        try{const res=await fetch(`/api/status/${code}?t=${Date.now()}`,{cache:'no-store'});if(!res.ok){scheduleNextPoll(code);return;}const data=await res.json();
        if(data.status==='confirmed'){
            document.getElementById("statusPending").style.display="none";document.getElementById("statusConfirmed").style.display="block";
            document.getElementById("confirmationCodeConfirmed").innerText=code;
            let details=`<div class="detail-row"><span class="label">üìÖ –î–∞—Ç–∞</span><span class="value">${formatDateBg(data.date)}</span></div><div class="detail-row"><span class="label">‚è∞ –ß–∞—Å</span><span class="value">${data.time}</span></div><div class="detail-row"><span class="label">üíÜ –£—Å–ª—É–≥–∞</span><span class="value">${data.service}</span></div>`;
            if(data.stylist) details+=`<div class="detail-row"><span class="label">üë© –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</span><span class="value">${data.stylist}</span></div>`;
            document.getElementById("bookingDetails").innerHTML=details;
        } else if(data.status==='rejected'){document.getElementById("statusPending").style.display="none";document.getElementById("statusRejected").style.display="block";}
        else{scheduleNextPoll(code);}}catch(e){scheduleNextPoll(code);}
    }

    function formatDateBg(ds){const d=new Date(ds);const days=['–ù–µ–¥–µ–ª—è','–ü–æ–Ω–µ–¥–µ–ª–Ω–∏–∫','–í—Ç–æ—Ä–Ω–∏–∫','–°—Ä—è–¥–∞','–ß–µ—Ç–≤—ä—Ä—Ç—ä–∫','–ü–µ—Ç—ä–∫','–°—ä–±–æ—Ç–∞'];const months=['—è–Ω—É–∞—Ä–∏','—Ñ–µ–≤—Ä—É–∞—Ä–∏','–º–∞—Ä—Ç','–∞–ø—Ä–∏–ª','–º–∞–π','—é–Ω–∏','—é–ª–∏','–∞–≤–≥—É—Å—Ç','—Å–µ–ø—Ç–µ–º–≤—Ä–∏','–æ–∫—Ç–æ–º–≤—Ä–∏','–Ω–æ–µ–º–≤—Ä–∏','–¥–µ–∫–µ–º–≤—Ä–∏'];return `${days[d.getDay()]}, ${d.getDate()} ${months[d.getMonth()]}`;}

    async function loadSlots(){
        const date=document.getElementById("datePicker").value;if(!date)return;const grid=document.getElementById("slotsGrid");grid.innerHTML="<p>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</p>";
        try{
            let url = `/api/slots?date=${date}`;
            if (selectedStylist) url += `&stylist=${encodeURIComponent(selectedStylist)}`;
            const res=await fetch(url);const slots=await res.json();grid.innerHTML="";
            const today=new Date();const isToday=date===today.toISOString().split('T')[0];const ch=today.getHours(),cm=today.getMinutes();
            const avail=slots.filter(s=>{if(!isToday)return true;const[h,m]=s.time.split(':').map(Number);return h>ch||(h===ch&&m>cm);});
            if(!avail.length){grid.innerHTML="<p class='placeholder-text'>–ù—è–º–∞ —Å–≤–æ–±–æ–¥–Ω–∏ —á–∞—Å–æ–≤–µ –∑–∞ —Ç–∞–∑–∏ –¥–∞—Ç–∞.</p>";return;}
            avail.forEach(slot=>{const div=document.createElement("div");
                if(slot.status==='free'){div.className="time-slot free";div.innerText=slot.time;if(!selectedStylist&&slot.available)div.title=slot.available+' —Å–≤–æ–±–æ–¥–Ω–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∏';div.onclick=()=>selectTime(div,slot.time);}
                else{div.className="time-slot taken";div.innerText=slot.time;}
                grid.appendChild(div);});
        }catch(e){grid.innerHTML="<p class='placeholder-text'>–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—Ä—ä–∑–∫–∞.</p>";}
    }

    function selectTime(el,time){document.querySelectorAll('.time-slot.selected').forEach(d=>d.classList.remove('selected'));el.classList.add('selected');selectedTime=time;document.getElementById("clientDetails").style.display="block";}

    async function submitBooking(){
        const nv=document.getElementById("clientName").value.trim().length>0;
        const pv=/^(\+359|0)8[7-9][0-9]{7}$/.test(document.getElementById("clientPhone").value.replace(/[^0-9+]/g,''));
        document.getElementById("clientName").style.borderColor=nv?"rgba(232,160,191,0.15)":"#e87777";
        document.getElementById("clientPhone").style.borderColor=pv?"rgba(232,160,191,0.15)":"#e87777";
        document.getElementById("phoneError").style.display=pv?"none":"block";
        if(!nv||!pv||!selectedTime){if(!selectedTime)showToast("–ò–∑–±–µ—Ä–µ—Ç–µ —á–∞—Å!","error");return;}

        const btn=document.getElementById('submitBtn');btn.disabled=true;btn.querySelector('.btn-text').style.display='none';btn.querySelector('.btn-loading').style.display='inline';

        try{
            const body = {
                date:document.getElementById("datePicker").value,
                time:selectedTime,
                service:currentService,
                price:currentPrice,
                clientName:document.getElementById("clientName").value,
                clientPhone:document.getElementById("clientPhone").value,
                clientEmail:document.getElementById("clientEmail").value.trim()||null
            };
            if (selectedStylist) body.stylist = selectedStylist;

            const res=await fetch('/api/book',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
            const data=await res.json();
            if(res.ok){closeModal();showBookingStatus(data.confirmationCode);}
            else if(data.error==='blocked'){document.getElementById('blockedMessage').style.display='block';document.getElementById('submitBtn').style.display='none';}
            else if(data.error==='Slot taken'){showToast("–¢–æ–∑–∏ —á–∞—Å –≤–µ—á–µ –µ –∑–∞–µ—Ç!","error");loadSlots();}
            else{showToast("–ì—Ä–µ—à–∫–∞: "+(data.error||"–ü—Ä–æ–±–ª–µ–º"),"error");}
        }catch(e){showToast("–°—ä—Ä–≤—ä—Ä–Ω–∞ –≥—Ä–µ—à–∫–∞","error");}
        btn.disabled=false;btn.querySelector('.btn-text').style.display='inline';btn.querySelector('.btn-loading').style.display='none';
    }

    window.onclick=function(e){if(e.target==modal)closeModal();};

    // Nav highlight
    const sections=document.querySelectorAll('section[id]'),navLinks=document.querySelectorAll('nav a');
    function highlightNav(){const sy=window.scrollY;sections.forEach(s=>{const t=s.offsetTop-100,h=s.offsetHeight,id=s.getAttribute('id');if(sy>=t&&sy<t+h)navLinks.forEach(l=>{l.classList.remove('active');if(l.getAttribute('href')==='#'+id)l.classList.add('active');});});}
    window.addEventListener('scroll',()=>{
        highlightNav();
        // Show/hide floating button
        const fb=document.getElementById('floatingBtn');
        if(fb) fb.style.opacity = window.scrollY > 400 ? '1' : '0';
    });
    highlightNav();
    </script>
</body>
</html>
